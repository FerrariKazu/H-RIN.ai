# üéØ Multi-Candidate Comparative AI Analysis System

## Overview

**HR Buddy** now supports true multi-candidate comparative analysis using a mandatory two-pass AI evaluation system with Qwen2.5.

This implementation goes beyond simple resume scoring to provide **comparative hiring intelligence** - ranking candidates relative to each other, identifying strengths, weaknesses, and tailored hiring recommendations.

---

## üöÄ Quick Start

### Start Services
```bash
python backend/main.py
# Backend runs on http://localhost:8002

# In another terminal:
npm run dev
# Frontend runs on http://localhost:3000
```

### How to Use
1. Open http://localhost:3000
2. Enter **Job Requirements** (skills, experience level, domain)
3. **Drag & Drop 2-5 PDF resumes**
4. Click **Upload & Analyze**
5. Wait for PASS 1 + PASS 2 to complete (~60-150 seconds)
6. View comparative results

---

## üìä Two-Pass Analysis System

### PASS 1: Individual Candidate Analysis
For each resume:
- Extract candidate profile (name, seniority, domain)
- Summarize experience
- Extract skills (technical + soft)
- Identify entities (companies, roles, certifications, tools)
- Generate preliminary AI fit score (0-100)
- Recommend roles

**Output:** Per-candidate analysis stored with `document_id`

### PASS 2: Cross-Candidate Comparative Analysis
After PASS 1 completes for all candidates:
- Single LLM call receives ALL candidates together
- Compares candidates AGAINST each other (not in isolation)
- Normalizes scores across batch
- Ranks candidates: Best fit ‚Üí Worst fit
- Explains WHY Candidate A outranks B
- Identifies strongest candidate, best skills, biggest gaps
- Provides tailored recommendations per candidate

**Output:** Comparative ranking with explanations and recommendations

---

## üìã Features

### Per-Candidate Results (PASS 1)
‚úÖ Candidate profile (name, seniority, domain)
‚úÖ Experience summary (generated by LLM)
‚úÖ Skills breakdown (technical + soft)
‚úÖ Entities (certifications, tools, companies, roles)
‚úÖ Preliminary fit score (0-100)
‚úÖ Recommended roles (5+)

### Comparative Results (PASS 2)
‚úÖ **Ranked candidates** with normalized scores
‚úÖ **Explanations** for each ranking (why A beats B)
‚úÖ **Strengths comparison** (who excels where)
‚úÖ **Weaknesses comparison** (gaps per candidate)
‚úÖ **Skill coverage matrix** (covered vs missing skills)
‚úÖ **Top candidate recommendation**
‚úÖ **Tailored hiring recommendations** (different per candidate)
‚úÖ **Executive summary** of all candidates

### Frontend Display
‚úÖ Individual candidate panels (PASS 1 results)
‚úÖ Comparative ranking table
‚úÖ Side-by-side skill comparison
‚úÖ AI fit score bars (color-coded)
‚úÖ Sorting by: score, name, skills, experience

---

## ü§ñ LLM Enforcement

### Why Two Passes?
Single-pass analysis evaluates candidates in isolation - a Senior Engineer vs. a Junior looks great. Two-pass comparison forces Qwen2.5 to evaluate candidates RELATIVE to each other.

### Prompt Enforcement
```
"You are comparing candidates against each other. 
Do NOT evaluate them independently."
```

### Quality Checks
- ‚úÖ Scores must vary (no identical scores across batch)
- ‚úÖ Must reference specific candidates by ID
- ‚úÖ Must use comparative language ("better than", "stronger in", "lacks")
- ‚úÖ Recommendations must be tailored per candidate

---

## üìä Output Example

### Request
```
POST /batch-analyze
- Files: [resume1.pdf, resume2.pdf, resume3.pdf]
- Job Requirements: "Senior Full-Stack Engineer. Required: Python, React, AWS. 5+ years."
```

### Response
```json
{
  "batch_id": "batch_1702707000",
  "job_requirements": "Senior Full-Stack Engineer...",
  "documents": [
    {
      "document_id": "doc_batch_1702707000_1_...",
      "filename": "candidate1.pdf",
      "status": "success",
      "analysis": {
        "llm_analysis": {
          "candidate_name": "John Doe",
          "experience_summary": "10 years full-stack",
          "skills": {
            "technical": ["Python", "React", "AWS", "Docker"],
            "soft": ["Leadership", "Communication"]
          },
          "overall_score": 82,
          "preliminary_fit_score": 82,
          "recommended_roles": ["Senior Engineer", "Tech Lead", "Architect", ...]
        }
      }
    }
    // ... more candidates
  ],
  "comparative_analysis": {
    "comparative_ranking": [
      {
        "document_id": "doc_batch_1702707000_1_...",
        "rank": 1,
        "normalized_fit_score": 88,
        "rationale": "Strongest overall fit. 10+ years experience with AWS/Python. Leadership skills align with senior role."
      },
      {
        "document_id": "doc_batch_1702707000_2_...",
        "rank": 2,
        "normalized_fit_score": 72,
        "rationale": "Strong React/Node experience but lacks AWS. Would need 2-3 month ramp-up."
      },
      {
        "document_id": "doc_batch_1702707000_3_...",
        "rank": 3,
        "normalized_fit_score": 58,
        "rationale": "Junior level, missing key experience for senior role."
      }
    ],
    "strengths_comparison": "Candidate 1 dominates backend infrastructure... Candidate 2 stronger in frontend... Both have leadership but Candidate 1 has larger team experience.",
    "weaknesses_comparison": "Candidate 1 lacks modern frontend... Candidate 2 has no cloud experience... Candidate 3 needs years of experience.",
    "skill_coverage_matrix": {
      "doc_batch_...1": {
        "covered": ["Python", "AWS", "Docker", "Leadership"],
        "missing": ["Machine Learning", "DevOps"]
      },
      "doc_batch_...2": {
        "covered": ["React", "TypeScript", "PostgreSQL"],
        "missing": ["Cloud Platforms", "System Design"]
      },
      "doc_batch_...3": {
        "covered": ["JavaScript", "React"],
        "missing": ["Backend", "AWS", "Docker", "Experience"]
      }
    },
    "strongest_candidate": {
      "document_id": "doc_batch_1702707000_1_...",
      "reason": "Highest overall fit with comprehensive skills and proven leadership."
    },
    "best_skill_coverage": {
      "document_id": "doc_batch_1702707000_1_...",
      "skills": ["Python", "AWS", "Docker", "Leadership"]
    },
    "hiring_recommendations": {
      "doc_batch_...1": "STRONG HIRE: Senior Engineer role. Ready for immediate impact.",
      "doc_batch_...2": "GOOD FIT: Mid-level Frontend role with backend mentorship. Invest in cloud upskilling.",
      "doc_batch_...3": "JUNIOR LEVEL: Consider for junior role with structured growth plan."
    },
    "executive_summary": "Candidate 1 is the clear winner for Senior role. Candidate 2 offers strong frontend skills. Candidate 3 needs more experience."
  }
}
```

---

## üîß Technical Stack

### Backend
- **Framework:** FastAPI (async)
- **LLM:** Ollama (Qwen2.5 7B)
- **PDF Processing:** PyMuPDF, pdfminer.six
- **NLP:** spaCy v3, transformers
- **Streaming:** HTTP streaming with `stream=True`, `flush=True`

### Frontend
- **Language:** Vanilla JavaScript
- **CSS:** Custom styling with CSS variables
- **Icons:** Lucide icons
- **API:** Fetch API with async/await

### Deployment
- **Backend Port:** 8002 (uvicorn)
- **Frontend Port:** 3000 (http-server)
- **Max Batch:** 5 PDFs per upload

---

## üìÅ Key Files

### Backend
- `backend/main.py` - Main API with `/batch-analyze` endpoint
- `backend/pipeline/llm_analyzer.py` - LLM analysis with `analyze_comparative()`
- `backend/pipeline/pdf_processor.py` - PDF extraction
- `backend/pipeline/nlp_engine_v2.py` - NLP entity extraction
- `backend/pipeline/resume_reconstructor.py` - JSON reconstruction

### Frontend
- `frontend/index.html` - UI structure
- `frontend/js/main.js` - Logic with `renderComparativeAnalysis()`
- `frontend/styles.css` - Styling with comparative table styles

---

## üìä Performance

| Scenario | Time |
|----------|------|
| 1 PDF (PASS 1 only) | 30-45s |
| 2 PDFs (PASS 1 + PASS 2) | 60-90s |
| 3 PDFs (PASS 1 + PASS 2) | 90-135s |
| 5 PDFs (PASS 1 + PASS 2) | 150-240s |

First call loads models (~30-60s). Subsequent calls faster.

---

## ‚úÖ Quality Assurance

### Comparative Quality Checks
The system verifies:
1. ‚úÖ Scores vary across candidates (no identical scores)
2. ‚úÖ Rankings reference different candidates
3. ‚úÖ Comparative language used ("vs", "better than", "weaker")
4. ‚úÖ Recommendations differ per candidate

### Failure Criteria (MUST NOT OCCUR)
- ‚ùå Identical scores for all candidates
- ‚ùå All candidates get same description
- ‚ùå No references to other candidates in comparison
- ‚ùå Generic recommendations (same for all)

---

## üß™ Testing

### Manual Testing
```bash
# 1. Start backend
python backend/main.py

# 2. In another terminal, start frontend
npm run dev

# 3. Open http://localhost:3000
# 4. Upload 2-3 PDFs with job requirements
# 5. Verify PASS 1 + PASS 2 results displayed
```

### Automated Testing
```bash
python test_batch_analysis.py
```

---

## üìö Documentation

See additional documentation:
- `HARD_REQUIREMENTS_CHECKLIST.md` - All requirements verified
- `MULTI_CANDIDATE_COMPARATIVE_ANALYSIS.md` - System overview
- `TWO_PASS_COMPARATIVE_SYSTEM.md` - Architecture details
- `IMPLEMENTATION_DETAILS.md` - Technical implementation
- `BATCH_IMPLEMENTATION_COMPLETE.md` - Batch processing details

---

## üöÄ Next Steps

### Ready to Use
‚úÖ Backend running on port 8002
‚úÖ Frontend ready on port 3000
‚úÖ All endpoints active
‚úÖ Two-pass system operational

### Try It Now
1. Gather 2-3 resume PDFs
2. Write job requirements
3. Upload batch
4. View comparative results

---

## üìû Support

### Common Issues

**Backend won't start:**
```
Check port 8002: netstat -ano | findstr :8002
Kill existing process: taskkill /PID <pid> /F
```

**Frontend not loading:**
```
Ensure backend is running: http://localhost:8002/health
Check frontend port 3000: npm run dev
```

**PASS 2 not appearing:**
```
Need 2+ successful candidates
Check logs for errors
Verify Ollama running
```

---

## ‚ú® Key Achievements

‚úÖ **True Comparative System** - Not repeated single-candidate analysis
‚úÖ **Two-Pass Architecture** - Individual + Comparative evaluation
‚úÖ **Qwen2.5 Enforcement** - All candidates in single LLM call
‚úÖ **Quality Verified** - Automatic checks for comparative nature
‚úÖ **Beautiful UI** - Comparative ranking, skill matrix, recommendations
‚úÖ **Production Ready** - Error handling, logging, performance optimized

---

## üìÑ License

HR Buddy - Multi-Candidate Comparative AI Analysis System
December 2025

